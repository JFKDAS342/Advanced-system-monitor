# –ö–æ–º–ø–∏–ª—è—Ç–æ—Ä –∏ —Ñ–ª–∞–≥–∏
CXX = g++
CXXFLAGS = -std=c++11 -Iinclude -Wall -Wextra -pedantic
LDFLAGS = 

# –î–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ –∏ —Ñ–∞–π–ª—ã
SRCDIR = src
INCDIR = include
SOURCES = $(wildcard $(SRCDIR)/*.cpp)
OBJECTS = $(SOURCES:.cpp=.o)
TARGET = server

# –û—Å–Ω–æ–≤–Ω–∞—è —Ü–µ–ª—å
$(TARGET): $(OBJECTS)
	@echo "üî® –õ–∏–Ω–∫–æ–≤–∫–∞ –∏—Å–ø–æ–ª–Ω—è–µ–º–æ–≥–æ —Ñ–∞–π–ª–∞..."
	$(CXX) $(OBJECTS) -o $(TARGET) $(LDFLAGS)
	@echo "‚úÖ –°–µ—Ä–≤–µ—Ä —Å–æ–±—Ä–∞–Ω: $(TARGET)"

# –ü—Ä–∞–≤–∏–ª–æ –¥–ª—è –∫–æ–º–ø–∏–ª—è—Ü–∏–∏ .cpp —Ñ–∞–π–ª–æ–≤
$(SRCDIR)/%.o: $(SRCDIR)/%.cpp
	@echo "üì¶ –ö–æ–º–ø–∏–ª—è—Ü–∏—è $<..."
	$(CXX) $(CXXFLAGS) -c $< -o $@

# –û—Å–Ω–æ–≤–Ω—ã–µ —Ü–µ–ª–∏
all: $(TARGET)

clean:
	@echo "üßπ –û—á–∏—Å—Ç–∫–∞ –ø—Ä–æ–µ–∫—Ç–∞..."
	rm -f $(OBJECTS) $(TARGET) server.log
	@echo "‚úÖ –ü—Ä–æ–µ–∫—Ç –æ—á–∏—â–µ–Ω"

run: $(TARGET)
	@echo "üöÄ –ó–∞–ø—É—Å–∫ —Å–µ—Ä–≤–µ—Ä–∞..."
	./$(TARGET)

debug: CXXFLAGS += -g -DDEBUG
debug: $(TARGET)

# –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –¥–ª—è –æ–±—ä–µ–∫—Ç–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤
$(SRCDIR)/main.o: $(INCDIR)/WebServer.h
$(SRCDIR)/WebServer.o: $(INCDIR)/WebServer.h $(INCDIR)/MetricsCollector.h
$(SRCDIR)/MetricsCollector.o: $(INCDIR)/MetricsCollector.h $(INCDIR)/JSONSerializer.h
$(SRCDIR)/JSONSerializer.o: $(INCDIR)/JSONSerializer.h
$(SRCDIR)/FileLogger.o: $(INCDIR)/FileLogger.h

.PHONY: all clean run debug info help